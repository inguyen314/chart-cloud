<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chart JS Cloud</title>
    <meta name="Description" content="U.S. Army Corps of Engineers St. Louis District Home Page" />
    <link rel="stylesheet" href="css/body.css" />
    <link rel="stylesheet" href="css/breadcrumbs.css" />
    <link rel="stylesheet" href="css/jumpMenu.css" />
    <!-- <link rel="stylesheet" href="css/sidebar.css" /> -->
    <link rel="stylesheet" href="css/style.css" />
    <script src="js/main.js"></script>
    <script src="js/libraries/moment.min.js"></script>
    <script src="js/libraries/moment-timezone-with-data.js"></script>
    <script src="js/chart.js"></script>
    <script src="js/libraries/chartjs-adapter-moment.min.js"></script>
</head>

<body>
    <div id="page-container">
        <header id="header">
            <!--Header content populated here by JavaScript Tag at end of body -->
        </header>
        <div class="page-wrap">
            <div class="container-fluid">
                <div id="breadcrumbs">
                </div>
                <div class="page-content">
                    <sidebar id="sidebar"></sidebar>
                    <div id="topPane" class="col-md backend-cp-collapsible">
                        <div class="box-usace">
                            <h2 class="box-header-striped">
                                <span class="titleLabel title">Title</span>
                                <span class="rss"></span>
                            </h2>
                            <div class="box-content" style="background-color:white;margin:auto">
                                <div class="content">
                                    <!-- Set Switch Menu Links -->
                                    <script>
                                        // Extract URL parameters
                                        const urlParams = new URLSearchParams(window.location.search);

                                        var basin = urlParams.get('basin');
                                        var cda = urlParams.get('cda');
                                        var lookback = urlParams.get('lookback') || '4';
                                        var cwms_ts_id = urlParams.get('cwms_ts_id') || 'St Louis-Mississippi.Stage.Inst.30Minutes.0.lrgsShef-rev';
                                        var cwms_ts_id_2 = urlParams.get('cwms_ts_id_2');
                                        var cwms_ts_id_3 = urlParams.get('cwms_ts_id_3');
                                        var cwms_ts_id_4 = urlParams.get('cwms_ts_id_4');
                                        var cwms_ts_id_5 = urlParams.get('cwms_ts_id_5');
                                        var cwms_ts_id_6 = urlParams.get('cwms_ts_id_6');
                                        var cwms_ts_id_7 = urlParams.get('cwms_ts_id_7');
                                        var cwms_ts_id_8 = urlParams.get('cwms_ts_id_8');
                                        var cwms_ts_id_9 = urlParams.get('cwms_ts_id_9');
                                        var cwms_ts_id_10 = urlParams.get('cwms_ts_id_10');
                                        var cwms_ts_id_11 = urlParams.get('cwms_ts_id_11');
                                        var cwms_ts_id_12 = urlParams.get('cwms_ts_id_12');
                                        var cwms_ts_id_13 = urlParams.get('cwms_ts_id_13');
                                        var cwms_ts_id_14 = urlParams.get('cwms_ts_id_14');
                                        var cwms_ts_id_15 = urlParams.get('cwms_ts_id_15');
                                        var cwms_ts_id_16 = urlParams.get('cwms_ts_id_16');
                                        var cwms_ts_id_17 = urlParams.get('cwms_ts_id_17');
                                        var cwms_ts_id_18 = urlParams.get('cwms_ts_id_18');
                                        var cwms_ts_id_19 = urlParams.get('cwms_ts_id_19');
                                        var cwms_ts_id_20 = urlParams.get('cwms_ts_id_20');
                                        var cwms_ts_id_21 = urlParams.get('cwms_ts_id_21');
                                        var cwms_ts_id_22 = urlParams.get('cwms_ts_id_22');
                                        var cwms_ts_id_23 = urlParams.get('cwms_ts_id_23');
                                        var cwms_ts_id_24 = urlParams.get('cwms_ts_id_24');
                                        var cwms_ts_id_25 = urlParams.get('cwms_ts_id_25');
                                        var cwms_ts_id_26 = urlParams.get('cwms_ts_id_26');
                                        var cwms_ts_id_27 = urlParams.get('cwms_ts_id_27');
                                        var cwms_ts_id_28 = urlParams.get('cwms_ts_id_28');
                                        var cwms_ts_id_29 = urlParams.get('cwms_ts_id_29');
                                        var cwms_ts_id_30 = urlParams.get('cwms_ts_id_30');
                                        var cwms_ts_id_31 = urlParams.get('cwms_ts_id_31');
                                        var cwms_ts_id_32 = urlParams.get('cwms_ts_id_32');
                                        var cwms_ts_id_33 = urlParams.get('cwms_ts_id_33');
                                        var cwms_ts_id_34 = urlParams.get('cwms_ts_id_34');
                                        var cwms_ts_id_35 = urlParams.get('cwms_ts_id_35');
                                        var cwms_ts_id_36 = urlParams.get('cwms_ts_id_36');
                                        var cwms_ts_id_37 = urlParams.get('cwms_ts_id_37');
                                        var cwms_ts_id_38 = urlParams.get('cwms_ts_id_38');
                                        var cwms_ts_id_39 = urlParams.get('cwms_ts_id_39');
                                        var cwms_ts_id_40 = urlParams.get('cwms_ts_id_40');
                                        var cwms_ts_id_41 = urlParams.get('cwms_ts_id_41');
                                        var cwms_ts_id_42 = urlParams.get('cwms_ts_id_42');
                                        var cwms_ts_id_43 = urlParams.get('cwms_ts_id_43');
                                        var cwms_ts_id_44 = urlParams.get('cwms_ts_id_44');
                                        var cwms_ts_id_45 = urlParams.get('cwms_ts_id_45');
                                        var cwms_ts_id_46 = urlParams.get('cwms_ts_id_46');
                                        var cwms_ts_id_47 = urlParams.get('cwms_ts_id_47');
                                        var cwms_ts_id_48 = urlParams.get('cwms_ts_id_48');
                                        var cwms_ts_id_49 = urlParams.get('cwms_ts_id_49');
                                        var cwms_ts_id_50 = urlParams.get('cwms_ts_id_50');
                                        var office = urlParams.get('office') || "MVS";
                                        var lookforward = urlParams.get('lookforward') || '0';
                                        var type = urlParams.get('type');
                                        var loading = urlParams.get('loading');

                                        console.log("type: ", type);
                                        console.log("basin: ", basin);
                                        console.log("lookback: ", lookback);
                                        console.log("loading: ", loading);

                                        // Extract text before the first period
                                        const cwms_ts_id_before_period = cwms_ts_id.split('.')[0];
                                        const titleElement = document.querySelector('.titleLabel.title');

                                        if (titleElement) {
                                            titleElement.innerHTML = cwms_ts_id_before_period;
                                            if (type) {
                                                titleElement.innerHTML += ` - ${type.toUpperCase()}`;
                                            }
                                            console.log('Title updated to:', titleElement.innerHTML);
                                        }


                                        // Calculate the document root
                                        const documentRoot = window.location.protocol + "//" + window.location.host + "/";
                                        console.log("documentRoot: ", documentRoot);

                                        // Determine the default value of cda based on documentRoot
                                        let cdaDefault = null;
                                        if (documentRoot === `https://wm.${office.toLocaleLowerCase()}.ds.usace.army.mil/`) {
                                            cdaDefault = "internal";
                                        } else if (documentRoot === `https://wm-${office.toLocaleLowerCase()}coop.mvk.ds.usace.army.mil/`) {
                                            cdaDefault = "internal-coop";
                                        } else {
                                            cdaDefault = "public";
                                        }
                                        console.log("cdaDefault: ", cdaDefault);

                                        if (cda === null) {
                                            cda = cdaDefault;
                                        }
                                        console.log("cda: ", cda);
                                    </script>

                                    <!-- loading spinner -->
                                    <div id="loading_chart" style="display: none;"><img src="images/loading4.gif"
                                            style='height: 50px; width: 50px;' alt="Loading..." /></div>

                                    <!-- chart js -->
                                    <div id="chart"><canvas id="myChart" width="800" height="500"></canvas></div>
                                    <script src="chart.js"></script>

                                    <!-- Notice -->
                                    <div id="notice">NOTICE: All data contained herein is preliminary in nature and
                                        therefore subject to change. The data is for general
                                        information purposes ONLY and SHALL NOT be used in technical applications such
                                        as, but not limited to, studies or designs.
                                        All critical data should be obtained from and verified by the United States Army
                                        Corps of Engineers. The United States Government
                                        assumes no liability for the completeness or accuracy of the data contained
                                        herein and any use of such data inconsistent with this
                                        disclaimer shall be solely at the risk of the user.</div>

                                    <!-- control lookback date, metadata, 6am value, and metadata -->
                                    <div class="gage_control_container">
                                        <!-- date input -->
                                        <div id="gage_control_01">
                                            <form id="numberForm" class="modern-form">
                                                <label for="numberInput">Lookback Days:</label>
                                                <input type="number" id="numberInput" name="numberInput" required>
                                                <button type="submit">Update</button>
                                            </form>
                                            <script>
                                                document.getElementById('numberForm').addEventListener('submit', function (event) {
                                                    event.preventDefault(); // Prevent the form from submitting the traditional way
                                                    const numberInput = document.getElementById('numberInput').value;
                                                    alert('You entered: ' + numberInput);
                                                });
                                            </script>
                                            <br>
                                            <form id="numberFormForward" class="modern-form">
                                                <label for="numberInputForward">Lookforward Days:</label>
                                                <input type="number" id="numberInputForward" name="numberInputForward"
                                                    required>
                                                <button type="submit">Update</button>
                                            </form>
                                            <script>
                                                document.getElementById('numberFormForward').addEventListener('submit', function (event) {
                                                    event.preventDefault(); // Prevent the form from submitting the traditional way
                                                    const numberInputForward = document.getElementById('numberInputForward').value;
                                                    alert('You entered: ' + numberInputForward);
                                                });
                                            </script>
                                        </div>
                                        <!-- basin input -->
                                        <div id="gage_control_02">
                                            <script>
                                                document.addEventListener('DOMContentLoaded', () => {
                                                    // console.log("basin inside gage_control_02", basin);
                                                    if (type === "editing") {
                                                        initializeBasinDropdownDataEditing(basin, office, type);
                                                    } else if (type === "loading") {
                                                        initializeBasinDropdownDataLoading(basin, office, type);
                                                    } else {
                                                        initializeBasinDropdown(basin, office);
                                                    }
                                                });
                                            </script>
                                        </div>

                                        <!-- data 6am level -->
                                        <div id="gage_control_03"></div>

                                        <!-- Location Data -->
                                        <div id="gage_control_04"></div>
                                    </div>

                                    <script>
                                        document.addEventListener('DOMContentLoaded', () => {
                                            if (cda === "public") {
                                                document.getElementById('gage_control_02').style.display = 'none';
                                                document.getElementById('gage_control_03').style.display = 'none';
                                                // document.getElementById('gage_control_04').style.display = 'none';
                                            }
                                        });
                                    </script>

                                    <!-- Switch API button -->
                                    <!-- Switch API button -->
                                    <div id="switchCda">
                                        <script>
                                            document.addEventListener('DOMContentLoaded', () => {
                                                addSwitchCdaLink(office, basin, cwms_ts_id, cda);
                                            });
                                        </script>
                                    </div>

                                    <div id="switchType">
                                        <script>
                                            if (type) {
                                                document.addEventListener('DOMContentLoaded', () => {
                                                    addSwitchTypeLink(office, basin, cwms_ts_id, cda, type, lookback);
                                                });
                                            }
                                        </script>
                                    </div>

                                    <!-- data table -->
                                    <div class="gage_control_container">
                                        <div id="data_table"></div>
                                        <div id="data_table_datman"></div>
                                        <div id="datman_load">
                                            <!-- <button id="loadDatmanButton">
                                                Load Datman Data
                                            </button> -->
                                            <div id="spinner" class="spinner" style="display: none;"></div>
                                            <div class="status"></div>
                                            <div class="datman_status"></div>
                                            <button id="cda-btn" class="cda-loading-button" disabled
                                                title="Save Data to CWMS and Datman">Login Save</button>
                                            <br><br>
                                            <div class="status_delete"></div>
                                            <button id="cda-delete-btn" class="cda-delete-button" disabled
                                                title="Only Delete CWMS, Not Datman">Login Delete</button>
                                            <!-- <br><br>
                                            <button id="datman" class="datman-loading-button">Save Datman Schema</button> -->
                                        </div>
                                        <div id="data_table_extent"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- url parameters and handle submit change lookback hours -->
                    <script>
                        // Pre-populate the number input field with the value of 'lookback'
                        document.getElementById('numberInput').value = lookback;
                        document.getElementById('numberInputForward').value = lookforward;

                        document.getElementById('numberForm').addEventListener('submit', function (event) {
                            event.preventDefault(); // Prevent the form from submitting the traditional way
                            const newLookback = document.getElementById('numberInput').value;
                            // Update the URL with the new lookback value and reload the page
                            const currentUrl = new URL(window.location.href);
                            currentUrl.searchParams.set('lookback', newLookback);
                            window.location.href = currentUrl.toString();
                        });

                        document.getElementById('numberFormForward').addEventListener('submit', function (event) {
                            event.preventDefault(); // Prevent the form from submitting the traditional way
                            const newLookforward = document.getElementById('numberInputForward').value;
                            // Update the URL with the new lookback value and reload the page
                            const currentUrl = new URL(window.location.href);
                            currentUrl.searchParams.set('lookforward', newLookforward);
                            window.location.href = currentUrl.toString();
                        });
                    </script>
                </div>
            </div>
            <button id="returnTop" title="Return to Top of Page">Top</button>
        </div>
    </div>
    <footer id="footer">
        <!--Footer content populated here by script tag at end of body -->
    </footer>
    <script src="js/libraries/jQuery-3.3.6.min.js"></script>
    <script defer>
        // When the document has loaded pull in the page header and footer skins
        $(document).ready(function () {
            // Change the v= to a different number to force clearing the cached version on the client browser
            $('#header').load('templates/DISTRICT.header.html');
            if (type === "editing") {
                if (basin === "Big Muddy") {
                    $('#sidebar').load('templates/DATA_EDITING.sidebar.BigMuddy.html');
                } else if (basin === "Cuivre") {
                    $('#sidebar').load('templates/DATA_EDITING.sidebar.Cuivre.html');
                } else if (basin === "Illinois") {
                    $('#sidebar').load('templates/DATA_EDITING.sidebar.Illinois.html');
                } else if (basin === "Kaskaskia") {
                    $('#sidebar').load('templates/DATA_EDITING.sidebar.Kaskaskia.html');
                } else if (basin === "Meramec") {
                    $('#sidebar').load('templates/DATA_EDITING.sidebar.Meramec.html');
                } else if (basin === "Mississippi") {
                    $('#sidebar').load('templates/DATA_EDITING.sidebar.Mississippi.html');
                } else if (basin === "Missouri") {
                    $('#sidebar').load('templates/DATA_EDITING.sidebar.Missouri.html');
                } else if (basin === "Ohio") {
                    $('#sidebar').load('templates/DATA_EDITING.sidebar.Ohio.html');
                } else if (basin === "Salt") {
                    $('#sidebar').load('templates/DATA_EDITING.sidebar.Salt.html');
                } else if (basin === "St Francis") {
                    $('#sidebar').load('templates/DATA_EDITING.sidebar.StFrancis.html');
                } else {
                    // $('#sidebar').load('templates/DISTRICT.sidebar.html');
                }
            } else if (type === "loading") {
                if (basin === "Big Muddy") {
                    $('#sidebar').load('templates/LOADING.sidebar.BigMuddy.html');
                } else if (basin === "Cuivre") {
                    $('#sidebar').load('templates/LOADING.sidebar.Cuivre.html');
                } else if (basin === "Illinois") {
                    $('#sidebar').load('templates/LOADING.sidebar.Illinois.html');
                } else if (basin === "Kaskaskia") {
                    $('#sidebar').load('templates/LOADING.sidebar.Kaskaskia.html');
                } else if (basin === "Meramec") {
                    $('#sidebar').load('templates/LOADING.sidebar.Meramec.html');
                } else if (basin === "Mississippi") {
                    $('#sidebar').load('templates/LOADING.sidebar.Mississippi.html');
                } else if (basin === "Missouri") {
                    $('#sidebar').load('templates/LOADING.sidebar.Missouri.html');
                } else if (basin === "Ohio") {
                    $('#sidebar').load('templates/LOADING.sidebar.Ohio.html');
                } else if (basin === "Salt") {
                    $('#sidebar').load('templates/LOADING.sidebar.Salt.html');
                } else if (basin === "St Francis") {
                    $('#sidebar').load('templates/LOADING.sidebar.StFrancis.html');
                } else {
                    // $('#sidebar').load('templates/DISTRICT.sidebar.html');
                }
            } else {
                if (basin === "Mississippi") {
                    $('#sidebar').load('templates/DISTRICT.sidebar.Mississippi.html');
                } else if (basin === "Illinois") {
                    $('#sidebar').load('templates/DISTRICT.sidebar.Illinois.html');
                } else if (basin === "Missouri") {
                    $('#sidebar').load('templates/DISTRICT.sidebar.Missouri.html');
                } else if (basin === "Meramec") {
                    $('#sidebar').load('templates/DISTRICT.sidebar.Meramec.html');
                } else if (basin === "Tributaries") {
                    $('#sidebar').load('templates/DISTRICT.sidebar.Tributaries.html');
                } else if (basin === "Mark Twain DO") {
                    $('#sidebar').load('templates/DISTRICT.sidebar.MarkTwainDo.html');
                } else if (basin === "Mark Twain") {
                    $('#sidebar').load('templates/DISTRICT.sidebar.MarkTwain.html');
                } else if (basin === "Wappapello") {
                    $('#sidebar').load('templates/DISTRICT.sidebar.Wappapello.html');
                } else if (basin === "Shelbyville") {
                    $('#sidebar').load('templates/DISTRICT.sidebar.Shelbyville.html');
                } else if (basin === "Carlyle") {
                    $('#sidebar').load('templates/DISTRICT.sidebar.Carlyle.html');
                } else if (basin === "Rend") {
                    $('#sidebar').load('templates/DISTRICT.sidebar.Rend.html');
                } else if (basin === "Kaskaskia Nav") {
                    $('#sidebar').load('templates/DISTRICT.sidebar.KaskaskiaNav.html');
                } else if (basin === "Water Quality") {
                    $('#sidebar').load('templates/DISTRICT.sidebar.WaterQuality.html');
                } else {
                    // $('#sidebar').load('templates/DISTRICT.sidebar.html');
                }
            }
            $('#footer').load('templates/DISTRICT.footer.html');
        })
    </script>
</body>

</html>